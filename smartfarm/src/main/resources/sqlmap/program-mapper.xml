<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="program">
<!-- 체험프로그램 총건수 -->
<select id="totalCount" resultType="integer">
select count(*) from program_plan
</select>

<!-- 체험프로그램 목록정보 -->
<select id="list" resultType="program">
	select *
from (select row_number() over(order by plan_start_date desc) no, p.*
      from program_plan p) n
where no between #{beginList} and #{endList}
order by no desc
</select>
<select id="info" resultType="program">
	select * from program_plan where id = #{id}
</select>
<!-- <select id="applicant_headcount" resultType="integer"> -->
<!-- 	select sum(headcount) from applicant where plan_id = #{plan_id} and to_char(application_date, 'yyyy-mm-dd') = #{application_date} and plan_time = #{plan_time} -->
<!-- 	select sum(headcount) from applicant where plan_id = #{plan_id} and   plan_time = #{plan_time} -->
<!-- </select> -->
<select id="applicant_headcount" resultType="integer">
	select 10-nvl(sum(headcount),0) from applicant where plan_id = #{plan_id} and   application_date = #{application_date} and   plan_time = #{plan_time}
<!-- 	select sum(headcount) from applicant where plan_id = #{plan_id} and   plan_time = #{plan_time} -->
</select>
<!-- 신규 체험신청 저장 -->
<insert id="application">
	insert into applicant ( name, phone, email, plan_id, headcount, application_date, plan_time  )
	values( #{name}, #{phone}, #{email}, #{plan_id}, #{headcount}, #{application_date}, #{plan_time})
</insert>
</mapper>